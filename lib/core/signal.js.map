{"version":3,"file":"signal.js","sourceRoot":"","sources":["../../src/core/signal.ts"],"names":[],"mappings":";;;AAgCA,oCA6BC;AAxDD,MAAa,YAAY;IAAzB;QACE,aAAQ,GAA6B,EAAE,CAAC;IAwB1C,CAAC;IAtBC,QAAQ,CAAC,EAAqB,EAAE,OAAgB,KAAK;QACnD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QACvB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,CAAC,GAAG,IAA2C;QACnD,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;IAChE,CAAC;IAED,WAAW,CAAC,GAAG,IAA2C;QACxD,OAAO,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;IAChF,CAAC;IAED,MAAM,CAAE,EAAqB;QAC3B,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QACxC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC/D,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;IACtB,CAAC;IAED,KAAK;QACH,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACrB,CAAC;CACF;AAzBD,oCAyBC;AAED,SAAgB,YAAY;IAU1B,MAAM,OAAO,GAAG,IAAI,YAAY,EAAqB,CAAC;IAEtD,SAAS,QAAQ,CAAY,EAAqB;QAChD,OAAO,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,KAAK,IAAI,CAAC,CAAC;IAC7C,CAAC;IAAA,CAAC;IAEF,QAAQ,CAAC,IAAI,GAAG,CAAC,EAAqB,EAAE,EAAE;QACxC,MAAM,QAAQ,GAAQ,UAAU,GAAG,IAAW;YAC5C,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YACrB,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC3B,CAAC,CAAA;QACD,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC7B,CAAC,CAAA;IACD,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAqB,EAAE,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;IAC/D,QAAQ,CAAC,MAAM,GAAG,CAAC,GAAG,IAA2C,EAAE,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC;IAC9F,QAAQ,CAAC,WAAW,GAAG,CAAC,GAAG,IAA2C,EAAE,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,CAAC;IACxG,QAAQ,CAAC,KAAK,GAAG,GAAG,EAAE,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;IAEvC,OAAO,QAAQ,CAAC;AAClB,CAAC","sourcesContent":["type FunctionParameters<T extends (...args: any[]) => any> =\r\n  T extends (...args: infer P) => any\r\n    ? P\r\n    : never;\r\n\r\nexport class EventEmitter<CallbackSignature extends (...args: any[]) => any> {\r\n  handlers: Array<CallbackSignature> = [];\r\n\r\n  register(cb: CallbackSignature, once: boolean = false) {\r\n    this.handlers.push(cb);\r\n    return this;\r\n  }\r\n\r\n  invoke(...args: FunctionParameters<CallbackSignature>) {\r\n    this.handlers.forEach((handler) => handler.apply(this, args));\r\n  }\r\n\r\n  invokeAsync(...args: FunctionParameters<CallbackSignature>) {\r\n    return Promise.all(this.handlers.map((handler) => handler.apply(this, args)));\r\n  }\r\n\r\n  remove (cb: CallbackSignature) {\r\n    const index = this.handlers.indexOf(cb);\r\n    this.handlers[index] = this.handlers[this.handlers.length - 1];\r\n    this.handlers.pop();\r\n  }\r\n\r\n  clear() {\r\n    this.handlers = [];\r\n  }\r\n}\r\n\r\nexport function createSignal<CallbackSignature extends (...args: any[]) => void | Promise<any>>()\r\n  : \r\n   {\r\n    once: (cb: CallbackSignature) => void;\r\n    remove: (cb: CallbackSignature) => void,\r\n    invoke: (...args: FunctionParameters<CallbackSignature>) => void,\r\n    invokeAsync: (...args: FunctionParameters<CallbackSignature>) => Promise<any[]>,\r\n    clear: () => void,\r\n  } & ((this: any, cb: CallbackSignature) => EventEmitter<CallbackSignature> )\r\n  {\r\n  const emitter = new EventEmitter<CallbackSignature>();\r\n\r\n  function register(this: any, cb: CallbackSignature): EventEmitter<CallbackSignature> {\r\n    return emitter.register(cb, this === null);\r\n  };\r\n\r\n  register.once = (cb: CallbackSignature) => {\r\n    const callback: any = function (...args: any[]) {\r\n      cb.apply(this, args);\r\n      emitter.remove(callback);\r\n    }\r\n    emitter.register(callback);\r\n  }\r\n  register.remove = (cb: CallbackSignature) => emitter.remove(cb)\r\n  register.invoke = (...args: FunctionParameters<CallbackSignature>) => emitter.invoke(...args);\r\n  register.invokeAsync = (...args: FunctionParameters<CallbackSignature>) => emitter.invokeAsync(...args);\r\n  register.clear = () => emitter.clear();\r\n\r\n  return register;\r\n}"]}